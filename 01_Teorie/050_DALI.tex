\chap DALI

\rfc{050_DALI.tex - vypracovat DALI}

\mnote{\inoval{DALI}}


% \medskip
% Vlastnosti DALI protokolu:
% \begitems
%     * Jednoduché zapojení řídících linek
%     * Řízení individuálních jednotek nebo skupin jednotek prostřednictvím adresování
%     * Současné ovládání všech jednotek prostřednictvím vysílání adres
%     * Jednoduchá struktura komunikace
%     * Možnost kontroly stavu jednotlivého nebo skupiny osvětlovacích zařízení včetně chyb, úrovní napájení atd.
%     * Vytváření vlastních scén osvětlení
%     * Logaritmické stmívání odpovídající citlivosti oka
%     * Větší funkčnost a~nižší náklady na systém ve srovnání se systémy 1-10V
% \enditems


\glref{DALI} (Digitální adresovatelné rozhraní pro osvětlení)
(jak je uvedeno \cite[dali_quick_start])
je standardizovaný protokol pro digitální komunikaci v systémech osvětlení.
Umožňuje obousměrnou výměnu dat mezi řídicími jednotkami a~elektronickými předřadníky světel.

\medskip\noindent
Technické detaily:
\begitems
    *{\sbf Norma:} IEC 623861
    *{\sbf Typ }kabelu: Dvoulinková sběrnice.
    *{\sbf Napájení:} Sběrnice slouží i pro napájení některých zařízení. Napětí se běžně pohybuje okolo
       16~V v klidovém stavu, ale během komunikace může kolísat.
    *{\sbf Komunikace:} Digitální, obousměrná.
    *{\sbf Typy příkazů:}
    \begitems\style o
        *{\sbf Ovládání:} Nastavení jasu, aktivace scén, vypnutí světel.
        *{\sbf Konfigurace:} Úprava délky stmívání, nastavení jasu ve scénách, přiřazení tlačítek ke skupinám.
        *{\sbf Dotazy:} Zjištění konfigurace světel, aktuálního jasu, hlášení poruch světel.
    \enditems
\enditems


\sec Důležité pojmy v normě IEC 62386:


Norma IEC 62386, která definuje protokol DALI, obsahuje řadu důležitých pojmů. Níže je uveden popis vybraných z nich:

\begitems\style n
* {\sbf Control Device} (Řídicí jednotka):

    \begitems
    * Toto je obecný termín pro zařízení v systému DALI, které odesílá řídicí příkazy a~dotazy.
      Řídicí zařízení se dále dělí na dva typy:
        \begitems\style o
        * {\sbf Application Controller} (Aplikační řadič): Hlavní řídicí jednotka v systému DALI,
            která je zodpovědná za celkovou koordinaci osvětlení.
            Může jím být například tlačítkový panel, počítač nebo inteligentní systém budovy.
        * {\sbf Input Device} (Vstupní zařízení): Zařízení, které generuje uživatelské vstupy
            a~odesílá je do aplikačního řadiče.
            Typickým příkladem je tlačítko stmívání, pohybový senzor nebo senzor okolního světla.
        \enditems
    \enditems
* {\sbf Control Gear, Ballast} (Předřadník světelného zdroje):
    \begitems
        * Toto je elektronické zařízení, které reguluje napájení a~proud dodávaný do světelného zdroje.
            V~systému DALI může předřadník přijímat řídicí příkazy a~dotazy z~řídicího zařízení a~podle nich
            upravovat jas a~další parametry světelného zdroje.
    \enditems
\enditems


Řídící jednotka, předřadník a~napájecí zdroje sběrnice jsou
tři základní typy zařízení, které se vyskytují na sběrnici v systému DALI.


\sec DALI verze 2 a~DALI verze 1

Hlavním problémem původní verze DALI (IEC 62386) byla nedostatečná specifikace chování
řídicích jednotek. Norma definovala pouze fungování předřadníků \cite[iec102],
čímž dala výrobcům řídicích jednotek značnou volnost v implementaci.
To vedlo k nekompatibilitě a~nemožnosti vzájemného propojení zařízení od různých dodavatelů.

Dalším problémem bylo omezení umístění vstupních jednotek, jako jsou tlačítka a~senzory.
Norma DALI v1 neumožňovala připojení těchto zařízení přímo na sběrnici.
Musely být připojeny k řídicí jednotce, která pak s nimi komunikovala
a předávala informace předřadníkům.
To zvyšovalo složitost a~náklady na instalaci a~omezovalo flexibilitu systému.

DALI-2, uvedená v roce 2017, tento problém napravuje. Norma rozšiřuje specifikaci a~zahrnuje
i~chování řídicích jednotek \cite[iec103]. Díky tomu jsou všechna zařízení v DALI-2 systému vzájemně kompatibilní.
Kromě toho zavádí DALI-2 certifikační program, který zaručuje, že všechna certifikovaná zařízení splňují normu IEC 62386.

\medskip
Aby se zachovala kompatibilita se staršími systémy, rozlišuje DALI-2 dva typy řídicích jednotek:
\begitems
    *{\sbf Single master:} Tyto jednotky jsou kompatibilní s DALI v1 a~fungují jako hlavní řídicí prvek v systému.
    *{\sbf Multi master:} Modernější řídicí jednotky, které umožňují pokročilejší funkce a~flexibilitu v DALI-2 systémech.
\enditems

Multi master DALI-2 má striktnější pravidla pro komunikaci. Jedním z příkladů je časování půl bitů:
\begitems
    *{\sbf Single master:} 366,7 až 466,7 µs (\cite[iec101], kapitola 8.1.1)
    *{\sbf Multi master:} 400,0 až 433,3 µs (\cite[iec101], kapitola 8.3.1)
\enditems

Tyto drobné rozdíly v časování můžou u některých starších zařízení způsobovat problémy
s kompatibilitou a~vylučovat je z provozu v multi master systémech.

V DALI systémech s více řídicími jednotkami (multi-master) může docházet
na sběrnici ke kolizím kvůli paralelní komunikaci.
Tyto řídící jednotky musí být schopny detekovat kolize a~řešit je.
V single master systému je pouze jedna řídicí jednotka, která odesílá pokyny na sběrnici.
Nemusí přijímat data, protože je jediným komunikujícím zařízením.


Multi-master DALI zařízení jsou pokročilejší a flexibilnější než single-master.
Díky obousměrné komunikaci a detekci kolizí umožňuje multi-master DALI implementaci
složitějších funkcí a konfigurací v osvětlovacích systémech. Single-master DALI zařízení
jsou vhodné pro základní aplikace, kde je potřeba ovládat osvětlení z jednoho centrálního
bodu, všechny vstupy jsou v dosahu řídící jednotky a není zapotřebí pokročilých funkcí.



\sec Elektrické specifikace
Fyzický nízký stav nebo aktivní stav pro DALI byl definován s~rozhraním napětí < 9,5V. Vysoký stav, nebo stav
DALI v~klidu, je rozhraní napětí mezi 9,5V a~22,5V, nejčastěji 16V. Maximální proud systému je omezen na 250 mA.
Doba odezvy obvodu pro omezení proudu je < 10 μs. Každý komponent připojený k~rozhraní může spotřebovat maximálně 2 mA.
Konektory na přijímači nejsou polarizované. DALI je obvykle opticky oddělen od mikrokontroléru a~má přenosovou
rychlost dat 1200 bitů za sekundu.
\medskip
https://www.researchgate.net/figure/DALI-Electrical-Specification_fig2_344319530
\medskip


\medskip \clabel[logika]{Logika}
\picw=8cm \cinspic 03_Obrazky/logika.png
\caption/f Logika
\medskip

\sec Topologie sběrnice

\medskip \clabel[topolgie]{Topologie sběrnice}
\picw=8cm \cinspic 03_Obrazky/g38.png
\caption/f Topologie sběrnice
\medskip

Protokol DALI omezuje systém na maximálně šedesát čtyři jednotky, maximálně šestnáct skupin a~maximálně šestnáct scén.
Každá z~těchto šedesáti čtyř jednotek je přiřazena krátká adresa, která je uložena v~zapalovači.
Každá jednotlivá jednotka může také obsahovat číslo přiřazení ke skupině, hodnoty osvětlovací scény,
časy zeslabování a~úrovně nouzového osvětlení. Krátké adresy mohou být během výroby programovány výrobcem
do zapalovače, nebo mohou být během instalace programovány designérem. Skupinové adresy jsou obvykle
přiděleny softwarově během instalace, což umožňuje budoucí změny ve struktuře skupin.

DALI má strukturu drátů volného tvaru, takže jsou povoleny daisy-chained, lineární, hvězdicové nebo smíšené
struktury drátů, s~výjimkou kruhových struktur spojení. DALI stanoví maximální vzdálenost 300 metrů mezi
jednotkami a~umožňuje maximální úbytek napětí 2 voltů přes propojovací dráty od napájecího zdroje rozhraní
k~jednotlivým jednotkám. Sběrnice DALI pracuje s~baudovou rychlostí 1200 bps, takže není potřeba speciální
kabely nebo dráty.

\sec Komunikace na sběrnici
Rámcům DALI (datovým paketům) se vytváří pomocí Manchester (bi-fázové) kódování, což se děje pomocí hardwaru UART.
Kód Manchester je digitální kódovací formát, ve kterém logická '1' reprezentuje nárůstový přechod,
který se vyskytuje během doby jednoho bitu, zatímco logická '0' reprezentuje poklesový přechod během
doby jednoho bitu (viz obrázek níže). Startovací a~stopovací bity jsou kódovány jako logická '1'.
\medskip
Rámců jsou přenášeny s~baudovou rychlostí 1200 bps a~každý rámec je vždy odeslán s~nejvýznamnějším bitem (MSb) první.
Protože baudová rychlost je 1200 bps, trvá každé období bitu 833,33 µs a~každé poloviční období bitu trvá 416,67 µs.
Časy polovičního období jsou důležité, protože Manchesterovo kódování vyžaduje dva přechody bitů pro každý logický datový bit.
Přední rámec je datový paket přenášený řídícím zařízením na řídicí zařízení nebo vstupní zařízení.
Přední rámec DALI 1.0 obsahuje Startovací bit, následovaný bytovou adresou, jedním datovým bytem a~dvěma Stopovacími bity.
\medskip
Přední rámec DALI 2.0 obsahuje Startovací bit, následovaný bytovou adresou, až dvěma datovými byty a~podmínkou Stop (viz obrázek 2).
Přední 24bitový rámec DALI 2.0, včetně Startovacího a~Stopovacího bitu, trvá 23,2 ms, nebo přibližně 56 polovičních období bitů,
zatímco 16bitový rámec trvá 16,2 ms, nebo 39 polovičních období bitů. Jakmile řídící zařízení dokončí přenos rámce,
musí řídící zařízení začít přenášet zpětný rámec nejdříve 5,5 ms (přibližně 14 polovičních období bitů)
a nejpozději 10,5 ms (přibližně 25 polovičních období). Jakmile byl zpětný rámec přijat v~plném rozsahu,
musí řídící zařízení počkat minimálně 2,4 ms (přibližně šest polovičních období) před odesláním dalšího
předního rámce (viz obrázek 3).
Zpětný rámec je odpovědní paket přenášený z~řídícího zařízení na řídící zařízení. Zpětný rámec se skládá
ze Startovacího bitu, jednoho datového bytu a~podmínky Stop (viz obrázek níže). Zpětný rámec, včetně Startovacího a
Stopovacího bitu, trvá 9,95 ms (přibližně 24 polovičních období bitů). Datový byte může mít libovolnou hodnotu,
v~závislosti na příkazu, který byl vydán řídícím zařízením. Pokud je datový byte zpětného rámce 0xFF,
je odpověď považována za "ano". Pokud se očekává odpověď a~sběrnice zůstane v~klidovém stavu, je odpověď považována za "ne".
\medskip
https://onlinedocs.microchip.com/pr/GUID-0CDBB4BA-5972-4F58-98B2-3F0408F3E10B-en-US-1/index.html?GUID-1BB46A02-D54C-415B-9487-617FD3AA8BC9
\medskip

\sec Shrnutí parametrů DALI protokolu

\medskip \clabel[p]{Parametry}
\picw=12cm \cinspic 03_Obrazky/specifikace.png
\caption/f Parametry
\medskip

\sec Popis Hardwaru

\medskip \clabel[schematic]{Schéma hardwaru}
\picw=12cm \cinspic 03_Obrazky/schematic.png
\caption/f Schéma DALI
\medskip

\medskip \clabel[schematic2]{Schéma hardwaru 2}
\picw=12cm \cinspic 03_Obrazky/schematic2.png
\caption/f Schéma DALI 2
\medskip



\sec Popis kabelu

\medskip \clabel[kabel]{kabel}
\picw=10cm \cinspic 03_Obrazky/kabel.png
\caption/f Kabel
\medskip


\medskip
\sec Popis příkazů

\begitems \style o
* off - Okamžité vypnutí světel
* set max level - Nastavení maximální hodnoty jasu.
* set min level - Nastavení minimální hodnoty jasu.
* Recall max level
* Recall min level
* set system failure level - Nastavení jasu při výpadku řidící jednotky.
* set power on level - Nastavení jasu při zapnutí proudu.
* set fade time - Nastavení času prolínání.
* set fade rate - Nastavení rychlosti prolínání.
* set short adress - Nastavení krátké adresy pro jednotlivé světelná zařízení.
* set scene - Nastavení světelné scény.
* go to scene - Přechod mezi jednotlivými scénami.
* identify device - Identifikace jednotlivých zařízení - světlené zařízení se rozbliká po dobu 10s.
* add to group - Přidání světelného zařízení do skupin.
* remove from group - Odstranění světelné zařízení ze skupiny.
* set operating mode - Nastavení operačního módu.
\enditems
\medskip

